{% extends "admin/base.html" %}

{% block script %}
<script src="{{ url_for('static', filename='vendor/jquery-3.7.1.min.js') }}"></script>
<script src="{{ url_for('static', filename='vendor/select2.min.js') }}"></script>
<script>
 {% include "admin/inc_record-form_script.js" %}
</script>
<script src="{{ url_for('static', filename='vendor/leaflet.js') }}"></script>
{% endblock %}

{% block style %}
<link href="{{ url_for('static', filename='vendor/select2.min.css') }}" rel="stylesheet" />
<link href="{{ url_for('static', filename='vendor/leaflet.css') }}" rel="stylesheet"/>
<link href="{{ url_for('admin.static', filename='record-form.css') }}" rel="stylesheet" />
{% endblock %}


{% block main %}
<button id="unlock-button"{% if not record_id %}class="uk-hidden"{% endif %}>ğŸ”“ ç·¨è¼¯(è§£é–)</button>

<a href="#" id="hide-left-col-btn" class="uk-button uk-button-link"><span uk-icon="icon: chevron-double-left;"></span>{{ _('é—œé–‰å´é‚Šæ¬„') }}</a>

<div class="uk-flex uk-flex-between">
  <nav aria-label="Breadcrumb">
    <ul class="uk-breadcrumb">
      <li><a href="/admin">Dashboard</a></li>
      <li><a href="/admin/records">{{ _('æ¡é›†ç´€éŒ„èˆ‡æ¨™æœ¬') }}</a></li>
      {#<li><span aria-current="page">{{ _('æ¨™ç±¤') }}</span></li>#}
    </ul>
  </nav>
  <a class="uk-button uk-button-default" href="{{ url_for('admin.print_label') }}?entities=r{{ record_id }}" target="_blank">{{ _('æ¨™ç±¤') }} </a>
</div>
<div class="form-container">
<form>
  <ul uk-tab>
    {% if current_user.site.data.phase == 1 %}
    <li class="uk-active"><a href="#" class="ndb-tab-nav" data-tab="raw-data">{{ _('åŸå§‹è³‡æ–™') }}</a></li>
    <li><a href="#" class="ndb-tab-nav" data-tab="occurrence">{{ _('å‡ºç¾ç´€éŒ„') }}</a></li>
    {% else %}
    <li class="uk-active"><a href="#" class="ndb-tab-nav" data-tab="occurrence">{{ _('å‡ºç¾ç´€éŒ„') }}</a></li>
    {% endif %}
    <li><a href="#" class="ndb-tab-nav" data-tab="assertion">{{ _('æ£²åœ°/ç’°å¢ƒ') }}</a></li>
    <li><a href="#" class="ndb-tab-nav" data-tab="identification">{{ _('é‘‘å®šç´€éŒ„') }} <span id="ndb-nav-identification-num"></span></a></li>
    {#<li><a href="#" class="ndb-tab-nav" data-tab="multimedia">{{ _('å¤šåª’é«”') }}</a></li>#}
    <li><a href="#" class="ndb-tab-nav" data-tab="changelog">{{ _('ç·¨è¼¯ç´€éŒ„') }}</a></li>
    <li><a href="#" class="ndb-tab-nav" data-tab="sourcedata">{{ _('åŸå§‹è³‡æ–™') }}</a></li>
  </ul>

  {% if current_user.site.data.phase == 1 %}
  <div id="raw-data-container" data-tab="raw-data" class="uk-grid-small ndb-tab-view" uk-grid>
  </div>
  {% endif %}
  <div data-tab="occurrence" class="ndb-tab-view{% if current_user.site.data.phase == 1 %} uk-hidden{% endif %}">
    <div class="uk-grid-small" uk-grid="masonry: pack">
      <div class="uk-width-1-2">
        <div class="ndb-fieldset">
          <div class="ndb-legend">{{ _('æ¡é›†è³‡è¨Š') }}</div>
          <div class="uk-grid-small" uk-grid>
            {{ widget('collector', _('æ¡é›†è€…'), '', '1-2@s', 'select2') }}
            {{ widget('field_number', _('æ¡é›†è™Ÿ'), '', '1-4@s') }}
            {{ widget('collect_date', _('æ¡é›†æ—¥æœŸ'), '', '1-4@s', 'input-date', placeholder='1988-05-15') }}

            {{ widget('verbatim_collector', _('æ¡é›†è€…'), '', '1-2@s', 'textarea', is_verbatim=True) }}
            {{ widget('verbatim_collect_date', _('æ¡é›†æ—¥æœŸ'), '', '1-4@s', is_verbatim=True) }}
            {{ widget('collect_date_text', _('æ¡é›†æ—¥æœŸ(éƒ¨ä»½)'), '', '1-4@s', placeholder='2015-03, 1985') }}

            {{ widget('companion_text', _('å”åŒæ¡é›†è€…'), '', '1-2@s', 'textarea') }}
            {{ widget('companion_text_en', _('å”åŒæ¡é›†è€…(è‹±æ–‡)'), '', '1-2@s', 'textarea', class_name='ndb-form-english') }}
            {{ widget('field_note', _('å‚™è¨»/æ¡é›†ç´€éŒ„'), '', '1-2@s', 'textarea') }}
            {{ widget('field_note_en', _('å‚™è¨»/æ¡é›†ç´€éŒ„(è‹±æ–‡)'), '', '1-2@s', 'textarea', class_name='ndb-form-english') }}
            <div class="uk-width-1-1">
              <span class="ndb-legend2">{{ _('ç‰©ç¨®') }}</span>
              <intput type="hidden" id="first-id_id-id" value="" />
            </div>
            {{ widget('first-id_taxon_id', _('å­¸å'), '', '1-1@s', 'select2') }}
            {{ widget('first-id_verbatim_identification', _('å­¸å'), '', '1-1@s', 'input', is_verbatim=True) }}
            {# widget('first-id_date_text', _('é‘‘å®šæ—¥æœŸ(éƒ¨ä»½)'), '', '1-4@s', 'input') #}
            {# widget('first-id_identifier_id', _('é‘‘å®šè€…'), '', '1-1@s', 'select2') }#}
            {# widget('first-id_date', _('é‘‘å®šæ—¥æœŸ'), '', '1-3@s', 'input-date', placeholder='2024-07-09') #}

            {# widget('first-id_verbatim_identifier', _('é‘‘å®šè€…'), '', '1-4@s', 'input', is_verbatim=True) #}
            {# widget('first-id_verbatim_date', _('é‘‘å®šæ—¥æœŸ'), '', '1-4@s', 'input', is_verbatim=True) #}
            {# widget('first-id_note', _('å‚™è¨»'), '', '1-1@s', 'textarea') #}

            {{ widget('last_identification', _('æœ€å¾Œé‘‘å®š'), '', '1-1@s', 'input', disabled=True) }}
          </div>
        </div>
      </div>
      <div class="uk-width-1-2">
        <div class="ndb-fieldset">
          <div class="ndb-legend">{{ _('æ¡é›†åœ°é»') }}</div>
          <div class="uk-grid-small" uk-grid>
            {{ widget('COUNTRY', 'åœ‹å®¶', '', '1-2@s', 'select2', 'fetch:/api/v1/named-areas;filter:area_class_id=7') }}
            {{ widget('ADM1', '1ç´šè¡Œæ”¿å€', '', '1-2@s', 'select2', 'fetch:/api/v1/named-areas;filter:area_class_id=8') }}
            {{ widget('ADM2', '2ç´šè¡Œæ”¿å€', '', '1-2@s', 'select2', 'fetch:/api/v1/named-areas;filter:area_class_id=9') }}
            {{ widget('ADM3', '3ç´šè¡Œæ”¿å€', '', '1-2@s', 'select2', 'fetch:/api/v1/named-areas;filter:area_class_id=10') }}
            <div class="uk-width-1-1">
              <div id="area-class-container" class="uk-grid-small" uk-grid></div>
            </div>
            {{ widget('locality_text', 'è©³ç´°åœ°é»', '', '1-1@s', 'textarea') }}
            {{ widget('locality_text_en', 'è©³ç´°åœ°é»(è‹±æ–‡)', '', '1-1@s', 'textarea', class_name='ndb-form-english') }}
            <div class="uk-width-1-1">
              <span class="ndb-legend2">{{ _('åœ°ç†è³‡è¨Š') }}</span>
            </div>
            <div class="uk-width-1-1@s" id="record-map-wrapper">
              <div id="record-map"></div>
            </div>
            {{ widget('altitude', 'æµ·æ‹”', '', '1-4@s', 'input') }}
            {{ widget('altitude2', 'æµ·æ‹”(æœ€é«˜)', '', '1-4@s', 'input') }}
            {{ widget('geodetic_datum', 'å¤§åœ°åº§æ¨™', '', '1-4@s', 'select', options=[{'text': 'WGS84', 'value': 'WGS84'}, {'text': 'TWD97', 'value': 'TWD97'},{'text': 'TWD67', 'value': 'TWD67'}]) }}
            <div class="uk-width-1-4">
              <div class="uk-margin">
                <label class="uk-form-label">&nbsp;</label>
                <div class="uk-form-controls">
                  <button class="uk-button uk-button-small uk-button-default" type="button" uk-toggle="target: #toggle-geo-dms">{{ _('åº¦åˆ†ç§’è½‰æ›å™¨') }}</button>
                </div>
              </div>
            </div>
            <div id="toggle-geo-dms" class="uk-width-1-1@s uk-grid-collapse" uk-grid hidden>
              {{ widget('lon-dir', 'æ±è¥¿ç¶“', '', '1-4@s', 'select', options=[{'value':1, 'text': 'E æ±ç¶“'}, {'value':-1, 'text': 'W è¥¿ç¶“'}], class_name='ndb-conv-coordinate') }}
              {{ widget('lon-degree', 'åº¦', '', '1-4@s', placeholder='-180 ~ 180', class_name='ndb-conv-coordinate', data={'coordinate': 'lon-degree'}) }}
              {{ widget('lon-minute', 'åˆ†', '', '1-4@s', placeholder='0~59', class_name='ndb-conv-coordinate') }}
              {{ widget('lon-second', 'ç§’', '', '1-4@s', placeholder='0~59', class_name='ndb-conv-coordinate') }}
              {{ widget('lat-dir', 'å—åŒ—ç·¯', '', '1-4@s', 'select', options=[{'value':1, 'text': 'N åŒ—ç·¯'}, {'value':-1, 'text': 'S å—ç·¯'}]) }}
              {{ widget('lat-degree', 'åº¦', '', '1-4@s', placeholder='-90 ~ 90', class_name='ndb-conv-coordinate') }}
              {{ widget('lat-minute', 'åˆ†', '', '1-4@s', placeholder='0~59', class_name='ndb-conv-coordinate') }}
              {{ widget('lat-second', 'ç§’', '', '1-4@s', placeholder='0~59', class_name='ndb-conv-coordinate') }}
            </div>
            {{ widget('longitude_decimal', _('ç¶“åº¦:åé€²ä½'), '', '1-4@s', class_name='ndb-conv-coordinate') }}
            {{ widget('latitude_decimal', _('ç·¯åº¦:åé€²ä½'), '', '1-4@s', class_name='ndb-conv-coordinate') }}
            {{ widget('verbatim_longitude', 'ç¶“åº¦', '', '1-4@s', placeholder='E 120Â° 58\' 55.29"', is_verbatim=True) }}
            {{ widget('verbatim_latitude', 'ç·¯åº¦', '', '1-4@s', placeholder='N 23Â° 58\' 25.95"', is_verbatim=True) }}
            {{ widget('verbatim_locality', 'æ¡é›†åœ°é»', '', '1-1@s', 'textarea', is_verbatim=True) }}
          </div>
        </div>
      </div>
      <div class="uk-width-1-2">
        <div class="ndb-fieldset">
          <div class="ndb-legend">{{ _('ç´€éŒ„è³‡è¨Š') }}</div>
          <div class="uk-grid-small" uk-grid>
            {{ widget('record_groups', _('ç¾¤çµ„(è¨ˆç•«...)'), '', '3-4@s', 'select2') }}
            {{ widget('pub_status', _('å…¬é–‹'), '', '1-4@s', 'select') }}
          </div>
        </div>
      </div>
    </div>
    <hr class="uk-divider-icon">
    <div uk-grid>
    <div class="uk-width-1-1">
      <div class="ndb-fieldset">
        <div class="ndb-legend">{{ _('æ¨™æœ¬è³‡è¨Š') }}</div>
        <button class="uk-button uk-button-small" type="button" id="unit-add-button">+{{ _('æ–°å¢') }}</button>
        <div id="unit-container" class="uk-child-width-1-2@s uk-child-width-1-3@m uk-child-width-1-3@l uk-child-width-1-4@xl" uk-grid>
        </div>
      </div>
    </div>
    </div><!-- END: occurrence -->
  </div>
  <div data-tab="assertion" class="uk-grid-small ndb-tab-view uk-hidden" uk-grid>
    <div class="uk-width-1-1">
      <fieldset class="uk-fieldset">
        <legend class="uk-legend">{{ _('æ£²åœ°/ç’°å¢ƒ') }}</legend>
        <div class="uk-grid-small" uk-grid id="record-assertions">
        </div>
      </fieldset>
    </div>
  </div><!-- END: assertion -->
  <div class="uk-grid-small ndb-tab-view uk-hidden" data-tab="identification" uk-grid>
    <h3 class="uk-heading-bullet">é‘‘å®š <button class="uk-button uk-button-small" type="button" id="identification-add-button">+{{ _('æ–°å¢') }}</button></h3>
    <div id="identification-container"></div>
  </div>{# end of nav identification #}

  <div class="uk-grid-small ndb-tab-view uk-hidden" data-tab="multimedia" uk-grid>
    <h3 class="uk-heading-bullet">{{ _('å¤šåª’é«”') }} </h3>
    <div class="uk-width-1-1">
    </div>
  </div>
  <div class="uk-grid-small ndb-tab-view uk-hidden" data-tab="changelog" uk-grid>
    <h3 class="uk-heading-bullet">{{ _('ç·¨è¼¯ç´€éŒ„') }}</h3>
    <div class="uk-width-1-1">
     <ul uk-accordion="multiple: true" id="changelog-container">
     </ul>
    </div>
  </div>
  <div class="uk-grid-small ndb-tab-view uk-hidden" data-tab="sourcedata" uk-grid>
    <h3 class="uk-heading-bullet">{{ _('åŸå§‹è³‡æ–™') }}</h3>
    <div class="uk-width-1-1">
      <pre><code id="sourcedata-content"></code></pre>
    </div>
  </div>

  <hr class="uk-divider-icon">
  <div class="uk-flex uk-flex-between">
    <div><button class="uk-button uk-button-danger" id="delete-button">{{ _('åˆªé™¤') }}</button></div>
    <div class="uk-flex uk-flex-right">
      <div class="uk-margin-left"><button class="uk-button uk-button-default" id="save-test-button">{{ _('test') }}</button></div>
      <div class="uk-margin-left"><button class="uk-button uk-button-secondary" id="save-new-button">{{ _('å„²å­˜ä¸¦æ–°å¢ä¸€ç­†') }}</button></div>
      <div class="uk-margin-left"><button class="uk-button uk-button-secondary" id="save-cont-button">{{ _('å„²å­˜ä¸¦ç¹¼çºŒç·¨è¼¯') }}</button></div>
      <div class="uk-margin-left"><button class="uk-button uk-button-primary" id="save-button">{{ _('å„²å­˜ä¸¦å›åˆ°è—å“åˆ—è¡¨') }}</button></div>
    </div>
  </div>
  <div id="unit-modal-container">
  </div>
</form>
<div id="overlay" class="overlay"{% if not record_id %} style="display:none;"{% endif %}></div>
</div>{# form-container #}

{% include "admin/inc_record-form_hidden.html" %}

{% endblock %}


{% macro widget(name, label, value='', width='1-4@s', type='input', options=[], placeholder='', is_verbatim=False, class_name='', data={}, disabled=False) -%}
<div class="uk-width-{{ width }}{# ndb-grid-tiny#}">
  <div class="uk-margin">
    <label class="uk-form-label" for="{{ name }}-id">{% if is_verbatim %}<span uk-icon="icon: file-text;"></span>[é€å­—]{% endif %}{{ label }}</label>
    <div class="uk-form-controls">
      {% if type == "input" %}
      <input class="uk-input uk-form-small{% if is_verbatim %} ndb-form-verbatim{% endif %}{% if class_name %} {{ class_name }}{% endif %}" id="{{ name }}-id" type="text" placeholder="{{ placeholder }}" name="{{ name }}" value="{{ value }}" {% for k, v in data.items() if v is not none %} data-{{ k }}="{{ v }}"{% endfor %}{% if disabled == True %} disabled{% endif %}>
      {% elif type == "input-date" %}
      <input class="uk-input uk-form-small" id="{{ name }}-id" type="date" name="{{ name }}" {% for k, v in data.items() if v is not none %} data-{{ k }}="{{ v }}"{% endfor %}>
      {% elif type == "input-number" %}
      <input class="uk-input uk-form-small{% if class_name %} {{ class_name }}{% endif %}" id="{{ name }}-id" type="number" name="{{ name }}" value="{{ value }}" {% for k, v in data.items() if v is not none %} data-{{ k }}="{{ v }}"{% endfor %}{% if disabled == True %} disabled{% endif %}>
      {% elif type == "textarea" %}
      <textarea name="{{ name }}" class="uk-textarea uk-form-small{% if is_verbatim %} ndb-form-verbatim{% endif %}{% if class_name %} {{ class_name }}{% endif %}" id="{{ name }}-id"{% if disabled == True %} disabled{% endif %}{% for k, v in data.items() if v is not none %} data-{{ k }}="{{ v }}"{% endfor %}>{{ value }}</textarea>
      {% elif type == "select" %}
      <select name="{{ name }}" class="uk-select uk-form-small" id="{{ name }}-id" {% for k, v in data.items() if v is not none %} data-{{ k }}="{{ v }}"{% endfor %}>
        {% for option in options %}
        <option value="{{ option.value }}">{{ option.text }}</option>
        {% endfor %}
      </select>
      {% elif type == "select2" %}
      <div class="bt-select-field">
        <select class="uk-select uk-form-small" id="{{ name }}-id" data-placeholder="{{ _('-- é¸æ“‡ --') }}" data-allow-clear="true" {% for k, v in data.items() if v is not none %} data-{{ k }}="{{ v }}"{% endfor %}>
        </select>
      </div>
      {% elif type == "combobox" %}
      <div class="combobox-container">
        <div class="uk-inline uk-width">
          <a class="uk-form-icon uk-form-icon-flip combobox-icon" uk-icon="icon: chevron-down" id="{{ name }}-id-icon" data-name="{{ name }}"></a>
          <input class="uk-input combobox-display" type="text" placeholder="-- é¸æ“‡ --" readonly id="{{ name }}-id-display" data-name="{{ name }}" data-value="" />
        </div>
        <div class="uk-inline combobox-input-container" id="{{ name }}-box-container">
          <span class="uk-form-icon" uk-icon="icon: search"></span>
          <input class="uk-input uk-form-small combobox-input" id="{{ name }}-input" data-name="{{ name }}" data-attr="{{ data }}" autocomplete="off"/>
        </div>
        <ul class="combobox-items-list" id="{{ name }}-list-container">
        </ul>
      </div>
      {% elif type == "input-hidden" %}
      <input class="" id="{{ name }}-id" type="hidden" name="{{ name }}" value="{{ value }}" {% for k, v in data.items() if v is not none %} data-{{ k }}="{{ v }}"{% endfor %}>
      {% endif %}
    </div>
  </div>
</div>
{%- endmacro %}

{% macro heading(title) -%}
<div class="uk-width-1-1 uk-grid-small">
  <h4 class="uk-heading-bullet">{{ title }}</h4>
</div>
{%- endmacro %}
