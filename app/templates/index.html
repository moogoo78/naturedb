{% extends "base.html" %}

{% macro filter_input(type_) %}
{% if type_ == "combobox" %}
<div class="w-full max-w-sm mx-auto">
  <form class="flex items-center">
    <label for="search-input" class="sr-only">Search</label>
    <div id="autocomplete-container" class="relative w-full">
      <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
        <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
        </svg>
      </div>
      <input type="text" id="search-input" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Search for a country..." autocomplete="off">
      <div id="dropdown-menu" class="hidden absolute z-10 mt-1 w-full bg-white rounded-lg shadow-lg dark:bg-gray-700">
        <ul id="results-list" class="py-2 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdown-button">
        </ul>
      </div>
    </div>
  </form>
</div>
{% endif %}
{% endmacro %}

{% block script %}
const countries = [
            "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Argentina", "Australia", "Austria", "Brazil", "Belgium", "Bolivia", "Canada", "Chile", "China", "Colombia", "Costa Rica", "Croatia", "Denmark", "Egypt", "Finland", "France", "Germany", "Greece", "Hungary", "Iceland", "India", "Indonesia", "Ireland", "Italy", "Japan", "Kenya", "Mexico", "Netherlands", "New Zealand", "Nigeria", "Norway", "Peru", "Poland", "Portugal", "Russia", "Saudi Arabia", "South Africa", "South Korea", "Spain", "Sweden", "Switzerland", "Turkey", "United Kingdom", "United States"
        ];

        // --- GET HTML ELEMENTS ---
        const searchInput = document.getElementById('search-input');
        const dropdownMenu = document.getElementById('dropdown-menu');
        const resultsList = document.getElementById('results-list');
        const autocompleteContainer = document.getElementById('autocomplete-container');

        // --- EVENT LISTENER FOR INPUT ---
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            
            // Clear previous results
            resultsList.innerHTML = '';

            // If input is empty, hide dropdown and exit
            if (searchTerm.length === 0) {
                dropdownMenu.classList.add('hidden');
                return;
            }

            // Filter options based on search term
            const filteredOptions = countries.filter(country =>
                country.toLowerCase().includes(searchTerm)
            );
            
            // If no results, hide dropdown
            if (filteredOptions.length === 0) {
                dropdownMenu.classList.add('hidden');
                return;
            }

            // Show dropdown
            dropdownMenu.classList.remove('hidden');

            // Populate dropdown with filtered results
            filteredOptions.forEach(option => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = '#';
                a.textContent = option;
                // Use Flowbite/Tailwind classes for styling
                a.className = 'block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white';
                
                // Event listener for when an item is clicked
                a.addEventListener('click', (event) => {
                    event.preventDefault();
                    searchInput.value = option;
                    dropdownMenu.classList.add('hidden');
                });
                
                li.appendChild(a);
                resultsList.appendChild(li);
            });
        });
        
        // --- HIDE DROPDOWN ON OUTSIDE CLICK ---
        document.addEventListener('click', (event) => {
            // Check if the click is outside the autocomplete container
            if (!autocompleteContainer.contains(event.target)) {
                dropdownMenu.classList.add('hidden');
            }
        });
{% endblock %}
{% block main %}
<main class="pt-16">
  <!-- Hero Search Section -->
  <section class="hero-section py-20 md:py-32">
    <div class="max-w-4xl mx-auto px-4 text-center">
      <h1 class="text-4xl md:text-6xl font-bold text-white mb-4">{{ g.site.title }}</h1>
      <p class="text-lg md:text-xl text-gray-200 mb-8">{{ g.site.title_en }}</p>

      <form id="search-form" class="bg-white/90 dark:bg-gray-800/90 p-6 rounded-xl shadow-2xl backdrop-blur-sm">
        <div class="relative">
          <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
            <i data-lucide="search" class="w-5 h-5 text-gray-500 dark:text-gray-400"></i>
          </div>
          <input type="search" id="main-search" class="block w-full p-4 ps-10 text-lg text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-green-500 focus:border-green-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-green-500 dark:focus:border-green-500" placeholder="Search by species, collector, or location..." required />
          <button type="submit" class="text-white absolute end-2.5 bottom-2.5 bg-green-700 hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-6 py-3 dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800">{{ _('搜尋標本') }}</button>
        </div>
        <div class="text-start mt-4">
          <button type="button" class="text-gray-900 dark:text-white hover:underline" data-drawer-target="drawer-filters" data-drawer-show="drawer-filters" aria-controls="drawer-filters">
            <i data-lucide="sliders-horizontal" class="inline-block w-4 h-4 mr-1"></i>
            {{ _('進階搜尋') }}{#Advanced Filters#}
          </button>
        </div>
      </form>
    </div>
  </section>

  <!-- Stats Section -->
  <section id="stats-section" class="bg-white dark:bg-gray-900 py-12">
    <div class="max-w-screen-xl mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8 text-center">
        <div class="p-6 bg-gray-50 dark:bg-gray-800 rounded-lg">
          <i data-lucide="leaf" class="w-12 h-12 text-green-500 mx-auto mb-4"></i>
          <h3 class="text-4xl font-bold text-gray-900 dark:text-white">{{ "{:0,d}".format(stats.unit_total) }}
</h3>
          <p class="text-gray-500 dark:text-gray-400 mt-2">{{ _('館藏標本總數') }}</p>
        </div>
        <div class="p-6 bg-gray-50 dark:bg-gray-800 rounded-lg">
          <i data-lucide="image" class="w-12 h-12 text-blue-500 mx-auto mb-4"></i>
          <h3 class="text-4xl font-bold text-gray-900 dark:text-white">{{ "{:0,d}".format(stats.media_total) }}</h3>
          <p class="text-gray-500 dark:text-gray-400 mt-2">{{ _('數位化影像') }}</p>
        </div>
        <div class="p-6 bg-gray-50 dark:bg-gray-800 rounded-lg">
          <i data-lucide="download" class="w-12 h-12 text-purple-500 mx-auto mb-4"></i>
          <h3 class="text-4xl font-bold text-gray-900 dark:text-white">{{ "{:0,d}".format(stats.accession_number_total) }}</h3>
          <p class="text-gray-500 dark:text-gray-400 mt-2">{{ _('入庫數量') }}</p>
        </div>
        <div class="p-6 bg-gray-50 dark:bg-gray-800 rounded-lg">
          <i data-lucide="download" class="w-12 h-12 text-purple-500 mx-auto mb-4"></i>
          <h3 class="text-4xl font-bold text-gray-900 dark:text-white">{{ "{:0,d}".format(stats.datasets|length) }}</h3>
          <p class="text-gray-500 dark:text-gray-400 mt-2">{{ _('典藏類別') }}</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Specimens -->
  <section class="py-12 bg-white dark:bg-gray-900">
    <div class="max-w-screen-xl mx-auto px-4">
      <h2 class="text-3xl font-bold text-gray-900 dark:text-white text-center mb-8">Featured Specimens</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        {% for unit in features %}
        <div class="max-w-sm bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700 transform transition-transform duration-300 card-hover">
          <a href="specimen.html">
            <img class="rounded-t-lg object-cover h-48 w-full" src="{{ unit.get_cover_image() }}" alt="{{ unit.record.proxy_taxon_scientific_name }}" />
          </a>
          <div class="p-5">
            <p class="mb-3 font-normal text-gray-700 dark:text-gray-400"><strong>館號: </strong>{{ unit.catalog_number }}</p>
            <a href="specimen.html">
              <h5 class="mb-2 text-xl font-bold tracking-tight text-gray-900 dark:text-white italic">{{ unit.record.proxy_taxon_scientific_name }}</h5>
            </a>
            <p class="mb-3 font-normal text-gray-700 dark:text-gray-400"><strong>{{ unit.record.proxy_taxon_common_name }}{#Family:#}</strong>{# Asteraceae#}</p>
            <p class="mb-3 font-normal text-gray-700 dark:text-gray-400">{% if unit.record.collector %}{{ unit.record.collector.full_name }}{% endif %} {{ unit.record.field_number }}{% if unit.record.collect_date %} | {{ unit.record.collect_date.strftime('%Y.%m.%d') }}{% endif %}</p>
            <p class="mb-3 font-normal text-gray-700 dark:text-gray-400">{{ unit.record.get_named_area('ADM1').name or '--'}}, {{ unit.record.get_named_area('COUNTRY').name or '--' }}</p>
            <a href="specimen.html" class="inline-flex items-center px-3 py-2 text-sm font-medium text-center text-white bg-green-700 rounded-lg hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-300 dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800">
              {{ _('詳細') }}{#View Details#}
              <svg class="rtl:rotate-180 w-3.5 h-3.5 ms-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 10">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 5h12m0 0L9 1m4 4L9 9"/>
              </svg>
            </a>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </section>

  <!-- Latest News -->
  <section class="py-12 bg-gray-50 dark:bg-gray-800">
    <div class="max-w-screen-xl mx-auto px-4">
      <h2 class="text-3xl font-bold text-gray-900 dark:text-white text-center mb-8">{{ _('最新消息') }}{#Latest News#}</h2>
      <div class="space-y-8">
        {#
        <!-- News 1 (With Image) -->
        <article class="flex items-start space-x-6 p-6 bg-white dark:bg-gray-900 rounded-lg shadow-md border border-gray-200 dark:border-gray-700">
          <img class="w-32 h-32 object-cover rounded-lg" src="https://images.unsplash.com/photo-1574263867128-b5e6dc3d8b4b?q=80&w=1974&auto=format&fit=crop" alt="Digital collection" />
          <div class="flex-1">
            <span class="text-sm font-medium text-white bg-blue-600 px-2 py-1 rounded-full mb-2 inline-block">Collection Update</span>
            <h3 class="mb-2 text-xl font-bold text-gray-900 dark:text-white">New Digital Collection Added</h3>
            <p class="mb-3 text-gray-700 dark:text-gray-400">Over 50,000 new specimens from the Amazon rainforest have been digitized and added to our collection.</p>
            <time class="text-sm text-gray-500 dark:text-gray-400">March 15, 2024</time>
          </div>
        </article>
        #}
        {% for i in news %}
        <article class="p-6 bg-white dark:bg-gray-900 rounded-lg shadow-md border border-gray-200 dark:border-gray-700">
          <div>
            <span class="text-sm font-medium text-white bg-{{ ['gray', 'red', 'yellow', 'green', 'blue', 'indigo', 'purple', 'pink'][(i.category.name+i.category.label)|length % 8]}}-600 px-2 py-1 rounded-full mb-2 inline-block">{{ i.category.label }}</span>
            <h3 class="mb-2 text-xl font-bold text-gray-900 dark:text-white">{{ i.subject }}</h3>
            <p class="mb-3 text-gray-700 dark:text-gray-400">{{ i.content|striptags }}</p>
            <div class="flex justify-between items-center">
              <time class="text-sm text-gray-500 dark:text-gray-400">{{ i.publish_date }}</time>
              <a href="{{ url_for('frontpage.article_detail', article_id=i.id) }}" class="text-green-600 hover:text-green-800 font-semibold text-sm">{{ _('詳細') }}{#Read Detail#} &rarr;</a>
            </div>
          </div>
        </article>
        {% endfor %}
      </div>
      <div class="text-center mt-12">
        <a href="{{ url_for('frontpage.news', lang_code=g.lang_code) }}" class="text-white bg-green-700 hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-base px-6 py-3 text-center dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800">{{ _('更多消息') }}{#Read More News#}</a>
      </div>
    </div>
  </section>
</main>
{% include "inc_filters_drawer.html" %}
{% endblock %}
